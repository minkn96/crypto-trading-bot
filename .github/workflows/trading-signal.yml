# .github/workflows/trading-signal.yml
name: ğŸ¯ ìŠ¤ë§ˆíŠ¸ íŠ¸ë ˆì´ë”© ì‹ í˜¸ (ì¤‘ë³µë°©ì§€ + í†µí•©ì•Œë¦¼)

on:
  schedule:
    # 5ë¶„ë§ˆë‹¤ ì‹¤í–‰
    - cron: '*/5 * * * *'
  
  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:

jobs:
  smart-trading:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
    
    - name: ğŸ Python í™˜ê²½ ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    # ğŸ”„ ì‹ í˜¸ íˆìŠ¤í† ë¦¬ ìºì‹œ ë³µì›
    - name: ğŸ’¾ ì‹ í˜¸ íˆìŠ¤í† ë¦¬ ìºì‹œ ë³µì›
      uses: actions/cache@v3
      with:
        path: signal_history.json
        key: trading-signals-${{ github.sha }}
        restore-keys: |
          trading-signals-
    
    - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        python -m pip install --upgrade pip
        pip install requests numpy
    
    - name: ğŸ¯ ìŠ¤ë§ˆíŠ¸ ì‹ í˜¸ ë¶„ì„ ì‹¤í–‰
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        echo "ğŸš€ ìŠ¤ë§ˆíŠ¸ íŠ¸ë ˆì´ë”© ë´‡ ì‹œì‘..."
        python trading_signal.py
    
    # ğŸ’¾ ì‹ í˜¸ íˆìŠ¤í† ë¦¬ ìºì‹œ ì €ì¥
    - name: ğŸ’¾ ì‹ í˜¸ íˆìŠ¤í† ë¦¬ ìºì‹œ ì €ì¥
      uses: actions/cache@v3
      if: always()
      with:
        path: signal_history.json
        key: trading-signals-${{ github.sha }}
    
    - name: ğŸ“Š ì‹¤í–‰ ê²°ê³¼ ìš”ì•½
      if: always()
      run: |
        echo "ğŸ• ì‹¤í–‰ ì™„ë£Œ: $(date)"
        if [ -f signal_history.json ]; then
          signal_count=$(cat signal_history.json | grep -o '":' | wc -l)
          echo "ğŸ“ í˜„ì¬ ì¶”ì  ì¤‘ì¸ ì‹ í˜¸: ${signal_count}ê°œ"
          echo "ğŸ“„ íˆìŠ¤í† ë¦¬ íŒŒì¼ í¬ê¸°: $(du -h signal_history.json | cut -f1)"
        else
          echo "ğŸ“ ì‹ í˜¸ íˆìŠ¤í† ë¦¬: ì—†ìŒ (ì²« ì‹¤í–‰)"
        fi
        echo "âœ… ìŠ¤ë§ˆíŠ¸ íŠ¸ë ˆì´ë”© ë´‡ ì‹¤í–‰ ì™„ë£Œ"
